"use strict";
var Sequelize, basename, config, db, env, fs, match, path, sequelize,
  indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; };

fs = require("fs");

path = require("path");

Sequelize = require("sequelize");

basename = path.basename(module.filename);

env = process.env.NODE_ENV || "development";

config = require(__dirname + '/../config/config.json')[env];

db = {};

if (process.env.DATABASE_URL) {
  match = process.env.DATABASE_URL.match(/postgres:\/\/([^:]+):([^@]+)@([^:]+):(\d+)\/(.+)/);
  sequelize = new Sequelize(process.env.DATABASE_URL, {
    dialect: 'postgres',
    protocol: 'postgres',
    port: match[4],
    host: match[3],
    logging: true
  });
} else {
  sequelize = new Sequelize(config.database, config.username, config.password, config);
}

fs.readdirSync(__dirname).filter(function(file) {
  return (file.indexOf(".") !== 0) && (file !== basename);
}).forEach(function(file) {
  var model;
  model = sequelize["import"](path.join(__dirname, file));
  return db[model.name] = model;
});

Object.keys(db).forEach(function(modelName) {
  if (indexOf.call(db[modelName], "associate") >= 0) {
    return db[modelName].associate(db);
  }
});

db.sequelize = sequelize;

db.Sequelize = Sequelize;

module.exports = db;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImluZGV4LmNvZmZlZSJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxZQUFBLENBQUE7QUFBQSxJQUFBLGdFQUFBO0VBQUEsbUpBQUE7O0FBQUEsRUFDQSxHQUFZLE9BQUEsQ0FBUSxJQUFSLENBRFosQ0FBQTs7QUFBQSxJQUVBLEdBQVksT0FBQSxDQUFRLE1BQVIsQ0FGWixDQUFBOztBQUFBLFNBR0EsR0FBWSxPQUFBLENBQVEsV0FBUixDQUhaLENBQUE7O0FBQUEsUUFJQSxHQUFZLElBQUksQ0FBQyxRQUFMLENBQWMsTUFBTSxDQUFDLFFBQXJCLENBSlosQ0FBQTs7QUFBQSxHQUtBLEdBQVksT0FBTyxDQUFDLEdBQUcsQ0FBQyxRQUFaLElBQXdCLGFBTHBDLENBQUE7O0FBQUEsTUFNQSxHQUFZLE9BQUEsQ0FBUSxTQUFBLEdBQVksd0JBQXBCLENBQThDLENBQUEsR0FBQSxDQU4xRCxDQUFBOztBQUFBLEVBT0EsR0FBWSxFQVBaLENBQUE7O0FBVUEsSUFBRyxPQUFPLENBQUMsR0FBRyxDQUFDLFlBQWY7QUFDRSxFQUFBLEtBQUEsR0FBUSxPQUFPLENBQUMsR0FBRyxDQUFDLFlBQVksQ0FBQyxLQUF6QixDQUErQixrREFBL0IsQ0FBUixDQUFBO0FBQUEsRUFDQSxTQUFBLEdBQWdCLElBQUEsU0FBQSxDQUFVLE9BQU8sQ0FBQyxHQUFHLENBQUMsWUFBdEIsRUFBb0M7QUFBQSxJQUNsRCxPQUFBLEVBQVUsVUFEd0M7QUFBQSxJQUVsRCxRQUFBLEVBQVUsVUFGd0M7QUFBQSxJQUdsRCxJQUFBLEVBQVUsS0FBTSxDQUFBLENBQUEsQ0FIa0M7QUFBQSxJQUlsRCxJQUFBLEVBQVUsS0FBTSxDQUFBLENBQUEsQ0FKa0M7QUFBQSxJQUtsRCxPQUFBLEVBQVUsSUFMd0M7R0FBcEMsQ0FEaEIsQ0FERjtDQUFBLE1BQUE7QUFVRSxFQUFBLFNBQUEsR0FBZ0IsSUFBQSxTQUFBLENBQVUsTUFBTSxDQUFDLFFBQWpCLEVBQTJCLE1BQU0sQ0FBQyxRQUFsQyxFQUE0QyxNQUFNLENBQUMsUUFBbkQsRUFBNkQsTUFBN0QsQ0FBaEIsQ0FWRjtDQVZBOztBQUFBLEVBd0JFLENBQUMsV0FESCxDQUNlLFNBRGYsQ0FFRSxDQUFDLE1BRkgsQ0FFVyxTQUFDLElBQUQsR0FBQTtBQUNQLFNBQU8sQ0FBQyxJQUFJLENBQUMsT0FBTCxDQUFhLEdBQWIsQ0FBQSxLQUF1QixDQUF4QixDQUFBLElBQStCLENBQUMsSUFBQSxLQUFVLFFBQVgsQ0FBdEMsQ0FETztBQUFBLENBRlgsQ0FLRSxDQUFDLE9BTEgsQ0FLVyxTQUFDLElBQUQsR0FBQTtBQUNQLE1BQUEsS0FBQTtBQUFBLEVBQUEsS0FBQSxHQUFRLFNBQVUsQ0FBQSxRQUFBLENBQVYsQ0FBb0IsSUFBSSxDQUFDLElBQUwsQ0FBVSxTQUFWLEVBQXFCLElBQXJCLENBQXBCLENBQVIsQ0FBQTtTQUNBLEVBQUcsQ0FBQSxLQUFLLENBQUMsSUFBTixDQUFILEdBQWlCLE1BRlY7QUFBQSxDQUxYLENBdkJBLENBQUE7O0FBQUEsTUFpQ00sQ0FBQyxJQUFQLENBQVksRUFBWixDQUFlLENBQUMsT0FBaEIsQ0FBd0IsU0FBQyxTQUFELEdBQUE7QUFDdEIsRUFBQSxJQUFHLGFBQWUsRUFBRyxDQUFBLFNBQUEsQ0FBbEIsRUFBQSxXQUFBLE1BQUg7V0FDRSxFQUFHLENBQUEsU0FBQSxDQUFVLENBQUMsU0FBZCxDQUF3QixFQUF4QixFQURGO0dBRHNCO0FBQUEsQ0FBeEIsQ0FqQ0EsQ0FBQTs7QUFBQSxFQXFDRSxDQUFDLFNBQUgsR0FBZSxTQXJDZixDQUFBOztBQUFBLEVBc0NFLENBQUMsU0FBSCxHQUFlLFNBdENmLENBQUE7O0FBQUEsTUF3Q00sQ0FBQyxPQUFQLEdBQWlCLEVBeENqQixDQUFBIiwiZmlsZSI6ImluZGV4LmpzIiwic291cmNlUm9vdCI6Ii9zb3VyY2UvIiwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5mcyAgICAgICAgPSByZXF1aXJlKFwiZnNcIik7XG5wYXRoICAgICAgPSByZXF1aXJlKFwicGF0aFwiKTtcblNlcXVlbGl6ZSA9IHJlcXVpcmUoXCJzZXF1ZWxpemVcIik7XG5iYXNlbmFtZSAgPSBwYXRoLmJhc2VuYW1lKG1vZHVsZS5maWxlbmFtZSk7XG5lbnYgICAgICAgPSBwcm9jZXNzLmVudi5OT0RFX0VOViB8fCBcImRldmVsb3BtZW50XCI7XG5jb25maWcgICAgPSByZXF1aXJlKF9fZGlybmFtZSArICcvLi4vY29uZmlnL2NvbmZpZy5qc29uJylbZW52XTtcbmRiICAgICAgICA9IHt9O1xuXG5cbmlmIHByb2Nlc3MuZW52LkRBVEFCQVNFX1VSTFxuICBtYXRjaCA9IHByb2Nlc3MuZW52LkRBVEFCQVNFX1VSTC5tYXRjaCgvcG9zdGdyZXM6XFwvXFwvKFteOl0rKTooW15AXSspQChbXjpdKyk6KFxcZCspXFwvKC4rKS8pXG4gIHNlcXVlbGl6ZSA9IG5ldyBTZXF1ZWxpemUgcHJvY2Vzcy5lbnYuREFUQUJBU0VfVVJMLCB7XG4gICAgZGlhbGVjdDogICdwb3N0Z3JlcydcbiAgICBwcm90b2NvbDogJ3Bvc3RncmVzJ1xuICAgIHBvcnQ6ICAgICBtYXRjaFs0XVxuICAgIGhvc3Q6ICAgICBtYXRjaFszXVxuICAgIGxvZ2dpbmc6ICB0cnVlXG4gIH1cbmVsc2VcbiAgc2VxdWVsaXplID0gbmV3IFNlcXVlbGl6ZShjb25maWcuZGF0YWJhc2UsIGNvbmZpZy51c2VybmFtZSwgY29uZmlnLnBhc3N3b3JkLCBjb25maWcpO1xuXG5cbmZzXG4gIC5yZWFkZGlyU3luYyhfX2Rpcm5hbWUpXG4gIC5maWx0ZXIoIChmaWxlKSAtPlxuICAgIHJldHVybiAoZmlsZS5pbmRleE9mKFwiLlwiKSBpc250IDApIGFuZCAoZmlsZSBpc250IGJhc2VuYW1lKTtcbiAgKVxuICAuZm9yRWFjaCgoZmlsZSkgLT5cbiAgICBtb2RlbCA9IHNlcXVlbGl6ZVtcImltcG9ydFwiXShwYXRoLmpvaW4oX19kaXJuYW1lLCBmaWxlKSk7XG4gICAgZGJbbW9kZWwubmFtZV0gPSBtb2RlbDtcbiAgKVxuXG5PYmplY3Qua2V5cyhkYikuZm9yRWFjaCAobW9kZWxOYW1lKSAtPlxuICBpZiBcImFzc29jaWF0ZVwiIGluIGRiW21vZGVsTmFtZV1cbiAgICBkYlttb2RlbE5hbWVdLmFzc29jaWF0ZShkYik7XG5cbmRiLnNlcXVlbGl6ZSA9IHNlcXVlbGl6ZTtcbmRiLlNlcXVlbGl6ZSA9IFNlcXVlbGl6ZTtcblxubW9kdWxlLmV4cG9ydHMgPSBkYjtcblxuXG4iXX0=